<div class="min-h-screen p-5 pt-20 text-black">
    <div class="mb-4 flex items-center justify-between">
        <h2 class="text-2xl font-bold text-gray-800">User List</h2>
        <button
            pButton
            type="button"
            label="Add User"
            icon="pi pi-plus"
            class="p-button-success"
            (click)="openAddDialog()"></button>
    </div>

    <div class="card rounded border border-gray-300 bg-white shadow">
        <p-table
            #dt2
            [value]="users"
            dataKey="id"
            [paginator]="true"
            [scrollable]="true"
            [rows]="10"
            [loading]="isLoading"
            [(selection)]="selectedUser"
            [globalFilterFields]="[
                'fullName',
                'status',
                'email',
                'id',
                'createdAt',
            ]"
            class="p-datatable-striped p-datatable-gridlines">
            <ng-template #caption>
                <div class="flex">
                    <p-iconfield iconPosition="left" class="ml-auto">
                        <p-inputicon>
                            <i class="pi pi-search"></i>
                        </p-inputicon>
                        <input
                            pInputText
                            type="text"
                            (input)="
                                dt2.filterGlobal(
                                    $event.target.value,
                                    'contains'
                                )
                            "
                            placeholder="Search keyword" />
                    </p-iconfield>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr class="bg-gray-800 text-white">
                    <th style="width: 2rem"><p-tableHeaderCheckbox /></th>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Created on</th>
                    <th>Updated on</th>
                    <th>Status</th>
                    <th>Role</th>
                    <th pFrozenColumn alignFrozen="right">Actions</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-user>
                <tr class="transition hover:bg-gray-50">
                    <td>
                        <p-tableCheckbox [value]="user" />
                    </td>
                    <td>{{ user.id }}</td>
                    <td>{{ user.fullName }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phone }}</td>
                    <td>{{ user.updatedAt | date: 'yyyy-MM-dd HH:mm:ss' }}</td>
                    <td>{{ user.createdAt | date: 'yyyy-MM-dd HH:mm:ss' }}</td>
                    <td>{{ user.status }}</td>
                    <td>
                        <span
                            class="rounded-full px-2 py-1 text-xs font-semibold"
                            [ngClass]="{
                                'bg-green-500 text-white':
                                    user.role === 'Admin',
                                'bg-blue-500 text-white':
                                    user.role === 'Manager',
                                'bg-gray-200 text-gray-800':
                                    !user.role || user.role === 'User',
                            }">
                            {{ user.role || 'User' }}
                        </span>
                    </td>
                    <td alignFrozen="right" pFrozenColumn>
                        <div class="flex w-full items-center justify-end gap-2">
                            <button
                                pButton
                                type="button"
                                class="p-button-sm p-button-info"
                                (click)="openEditDialog(user)">
                                Edit
                            </button>
                            <button
                                pButton
                                type="button"
                                class="p-button-sm p-button-danger"
                                (click)="deleteUser(user)">
                                Delete
                            </button>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>

    <p-dialog
        header="{{ isEdit ? 'Edit User' : 'Add User' }}"
        [(visible)]="displayDialog"
        [modal]="true"
        [closable]="true"
        [style]="{ width: '400px' }"
        [baseZIndex]="10000">
        <div class="p-fluid space-y-4">
            <div class="p-field flex flex-col">
                <label for="name" class="mb-1 font-semibold text-gray-700"
                    >Name</label
                >
                <input
                    id="name"
                    type="text"
                    pInputText
                    [(ngModel)]="selectedUser.fullName"
                    class="p-inputtext p-component rounded border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:outline-none" />
            </div>

            <div class="p-field flex flex-col">
                <label for="email" class="mb-1 font-semibold text-gray-700"
                    >Email</label
                >
                <input
                    id="email"
                    type="email"
                    pInputText
                    [(ngModel)]="selectedUser.email"
                    class="p-inputtext p-component rounded border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:outline-none" />
            </div>

            <div class="p-field flex flex-col">
                <label for="role" class="mb-1 font-semibold text-gray-700"
                    >Role</label
                >
                <input
                    id="role"
                    type="text"
                    pInputText
                    [(ngModel)]="selectedUser.role"
                    class="p-inputtext p-component rounded border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:outline-none" />
            </div>
        </div>

        <div class="mt-6 flex justify-end gap-3">
            <button
                pButton
                type="button"
                label="Cancel"
                class="p-button-text text-gray-600 hover:text-gray-800"
                (click)="cancelDialog()"></button>
            <button
                pButton
                type="button"
                label="{{ isEdit ? 'Save Change' : 'Add User' }}"
                class="p-button-succes bg-green-600 text-white hover:bg-green-700"
                (click)="saveUser()"></button>
        </div>
    </p-dialog>
</div>

<p-toast></p-toast>
