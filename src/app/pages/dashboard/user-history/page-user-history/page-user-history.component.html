<div class="min-h-screen p-5 pt-20 ">
  <h2 class="text-2xl font-bold mb-6 text-gray-800">User History List</h2>

  <p-table [value]="history" [paginator]="true" [rows]="10"
    class="p-datatable-striped p-datatable-gridlines min-w-full">

    <ng-template pTemplate="header">
      <tr class="bg-gray-800 text-white">
        <th>ID</th>
        <th>User</th>
        <th>IP</th>
        <th>Location</th>
        <th>Browser</th>
        <th>OS</th>
        <th>Device</th>
        <th>Login Time</th>
        <th>Logout Time</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-item>
      <tr class="hover:bg-gray-50 transition">
        <td>{{ item.id }}</td>
        <td class="font-semibold">{{ item.user_name }}</td>
        <td>{{ item.ip_address }}</td>
        <td>{{ item.city }}, {{ item.country }}</td>
        <td>{{ item.browser }}</td>
        <td>{{ item.os }}</td>
        <td class="capitalize">{{ item.device }}</td>
        <td>{{ item.login_time }}</td>
        <td>{{ item.logout_time || '---' }}</td>
        <td>
          <span class="px-2 py-1 rounded text-xs font-semibold" [ngClass]="{
                'bg-green-100 text-green-700': item.status === 'success',
                'bg-red-100 text-red-700': item.status === 'failed'
              }">
            {{ item.status }}
          </span>
        </td>
        <td class="flex gap-2">
          <button pButton type="button" label="Edit" class="p-button-sm p-button-info"
            (click)="openEditForm(item)"></button>
          <button pButton type="button" label="Delete" class="p-button-sm p-button-danger"
            (click)="deleteHistory(item.id)"></button>
        </td>
      </tr>
    </ng-template>

  </p-table>
  <p-dialog header="Edit Login History" [(visible)]="editFormVisible" [modal]="true" [style]="{width: '450px'}"
    [contentStyle]="{'padding':'1.5rem'}" [breakpoints]="{'960px': '95vw'}" [draggable]="false" [resizable]="false">

    <div class="p-fluid flex flex-col gap-4">


      <div>
        <label class="block text-sm font-semibold mb-1 text-gray-700">IP Address</label>
        <input pInputText [(ngModel)]="editingItem.ip_address"
          class="w-full p-3 rounded-lg border border-gray-300 shadow-sm focus:outline-none focus:border-indigo-500" />
      </div>


      <div>
        <label class="block text-sm font-semibold mb-1 text-gray-700">Browser</label>
        <input pInputText [(ngModel)]="editingItem.browser"
          class="w-full p-3 rounded-lg border border-gray-300 shadow-sm focus:outline-none focus:border-indigo-500" />
      </div>


      <div>
        <label class="block text-sm font-semibold mb-1 text-gray-700">Operating System</label>
        <input pInputText [(ngModel)]="editingItem.os"
          class="w-full p-3 rounded-lg border border-gray-300 shadow-sm focus:outline-none focus:border-indigo-500" />
      </div>


      <div>
        <label class="block text-sm font-semibold mb-1 text-gray-700">Device</label>
        <select [(ngModel)]="editingItem.device"
          class="w-full p-3 rounded-lg border border-gray-300 shadow-sm focus:outline-none focus:border-indigo-500">
          <option value="mobile">Mobile</option>
          <option value="desktop">Desktop</option>
        </select>
      </div>

    </div>


    <ng-template pTemplate="footer">
      <div class="flex justify-end gap-3 w-full">

        <button pButton type="button" label="Cancel"
          class="p-button-text p-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-100"
          (click)="editFormVisible = false">
        </button>

        <button pButton type="button" label="Save Changes" class="p-button-success p-2 px-4 rounded-lg"
          (click)="updateHistory()">
        </button>

      </div>
    </ng-template>

  </p-dialog>

  <p-confirmDialog></p-confirmDialog>
</div>