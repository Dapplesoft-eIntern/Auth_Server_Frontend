<p-confirmdialog></p-confirmdialog>
<div class="card rounded border border-gray-300 bg-white shadow">
    <p-table
        #dt2
        [value]="users"
        dataKey="id"
        [paginator]="true"
        [scrollable]="true"
        [rows]="10"
        [loading]="isLoading"
        [(selection)]="selectedUser"
        [globalFilterFields]="[
            'id',
            'fullName',
            'phone',
            'status',
            'email',
            'createdAt',
        ]"
        class="p-datatable-striped p-datatable-gridlines">
        <ng-template #caption>
            <div class="flex">
                <p-iconfield iconPosition="left" class="ml-auto">
                    <p-inputicon>
                        <i class="pi pi-search"></i>
                    </p-inputicon>
                    <input
                        pInputText
                        type="text"
                        (input)="
                            dt2.filterGlobal($any($event.target).value, 'contains')
                        "
                        placeholder="Search keyword" />
                </p-iconfield>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr class="bg-gray-800 text-white">
                <th style="width: 2rem"><p-tableHeaderCheckbox /></th>
                <th>ID</th>
                <th pSortableColumn="fullName">
                    <div class="flex items-center gap-2">
                        Full Name
                        <p-sortIcon field="fullName" />
                    </div>
                </th>
                <th>Email</th>
                <th>Phone</th>
                <th pSortableColumn="createdAt">
                    <div class="flex items-center gap-2">
                        Created on
                        <p-sortIcon field="createdAt" />
                    </div>
                </th>
                <th>Updated on</th>
                <th>Status</th>
                <th pSortableColumn="role">
                    <div class="flex items-center gap-2">
                        Role
                        <p-sortIcon field="role" />
                    </div>
                </th>
                <th pFrozenColumn alignFrozen="right">Actions</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-user>
            <tr class="transition hover:bg-gray-50">
                <td>
                    <p-tableCheckbox [value]="user" />
                </td>
                <td>{{ user.id }}</td>
                <td>{{ user.fullName }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.phone }}</td>
                <td>{{ user.updatedAt | date: 'yyyy-MM-dd HH:mm:ss' }}</td>
                <td>{{ user.createdAt | date: 'yyyy-MM-dd HH:mm:ss' }}</td>
                <td>{{ user.status }}</td>
                <td>
                    <span
                        class="rounded-full px-2 py-1 text-xs font-semibold"
                        [ngClass]="{
                            'bg-green-500 text-white': user.role === 1,
                            'bg-blue-500 text-white': user.role === 2,
                            'bg-gray-200 text-gray-800':
                                !user.role || user.role === 3,
                        }">
                        {{
                            (user.role === 1 )? 'Admin'
                                : (user.role === 2) ? 'Moderator'
                                : (user.role === 3) ? 'Editor'
                                : (user.role === 4) ? 'User'
                                : 'User'
                        }}
                    </span>
                </td>

                <td alignFrozen="right" pFrozenColumn>
                    <p-button
                        icon="pi pi-pencil"
                        class="mr-2"
                        [rounded]="true"
                        [outlined]="true"
                        (click)="openEditDialog(user)" />
                    <p-button
                        icon="pi pi-trash"
                        severity="danger"
                        [rounded]="true"
                        [outlined]="true"
                        (click)="deleteUser(user)" />
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>
